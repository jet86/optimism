"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.processGovernorBravoEvent = exports.governorBravoCommands = void 0;
const World_1 = require("../World");
const GovernorBravoBuilder_1 = require("../Builder/GovernorBravoBuilder");
const Invokation_1 = require("../Invokation");
const CoreValue_1 = require("../CoreValue");
const Command_1 = require("../Command");
const Verify_1 = require("../Verify");
const BravoProposalEvent_1 = require("./BravoProposalEvent");
const Utils_1 = require("../Utils");
const GovernorBravoValue_1 = require("../Value/GovernorBravoValue");
const Networks_1 = require("../Networks");
async function genGovernor(world, from, params) {
    let { world: nextWorld, governor, govData } = await GovernorBravoBuilder_1.buildGovernor(world, from, params);
    world = nextWorld;
    return World_1.addAction(world, `Deployed GovernorBravo ${govData.contract} to address ${governor._address}`, govData.invokation);
}
async function verifyGovernor(world, governor, apiKey, modelName, contractName) {
    if (world.isLocalNetwork()) {
        world.printer.printLine(`Politely declining to verify on local network: ${world.network}.`);
    }
    else {
        await Verify_1.verify(world, apiKey, modelName, contractName, governor._address);
    }
    return world;
}
async function mergeABI(world, from, governorDelegator, governorDelegate) {
    if (!world.dryRun) {
        // Skip this specifically on dry runs since it's likely to crash due to a number of reasons
        world = await Networks_1.mergeContractABI(world, "BravoDelegator", governorDelegator, governorDelegator.name, governorDelegate.name);
    }
    return world;
}
async function propose(world, from, governor, targets, values, signatures, calldatas, description) {
    const invokation = await Invokation_1.invoke(world, governor.methods.propose(targets, values, signatures, calldatas, description), from);
    return World_1.addAction(world, `Created new proposal "${description}" with id=${invokation.value} in Governor`, invokation);
}
async function setVotingDelay(world, from, governor, newVotingDelay) {
    let invokation = await Invokation_1.invoke(world, governor.methods._setVotingDelay(newVotingDelay.encode()), from);
    world = World_1.addAction(world, `Set voting delay to ${newVotingDelay.show()}`, invokation);
    return world;
}
async function setVotingPeriod(world, from, governor, newVotingPeriod) {
    let invokation = await Invokation_1.invoke(world, governor.methods._setVotingPeriod(newVotingPeriod.encode()), from);
    world = World_1.addAction(world, `Set voting period to ${newVotingPeriod.show()}`, invokation);
    return world;
}
async function setProposalThreshold(world, from, governor, newProposalThreshold) {
    let invokation = await Invokation_1.invoke(world, governor.methods._setProposalThreshold(newProposalThreshold.encode()), from);
    world = World_1.addAction(world, `Set proposal threshold to ${newProposalThreshold.show()}`, invokation);
    return world;
}
async function setImplementation(world, from, governor, newImplementation) {
    let invokation = await Invokation_1.invoke(world, governor.methods._setImplementation(newImplementation._address), from);
    world = World_1.addAction(world, `Set GovernorBravo implementation to ${newImplementation}`, invokation);
    mergeABI(world, from, governor, newImplementation);
    return world;
}
async function initiate(world, from, governor, governorAlpha) {
    let invokation = await Invokation_1.invoke(world, governor.methods._initiate(governorAlpha), from);
    world = World_1.addAction(world, `Initiated governor from GovernorAlpha at ${governorAlpha}`, invokation);
    return world;
}
async function harnessInitiate(world, from, governor) {
    let invokation = await Invokation_1.invoke(world, governor.methods._initiate(), from);
    world = World_1.addAction(world, `Initiated governor using harness function`, invokation);
    return world;
}
async function setPendingAdmin(world, from, governor, newPendingAdmin) {
    let invokation = await Invokation_1.invoke(world, governor.methods._setPendingAdmin(newPendingAdmin), from);
    world = World_1.addAction(world, `Governor pending admin set to ${newPendingAdmin}`, invokation);
    return world;
}
async function acceptAdmin(world, from, governor) {
    let invokation = await Invokation_1.invoke(world, governor.methods._acceptAdmin(), from);
    world = World_1.addAction(world, `Governor admin accepted`, invokation);
    return world;
}
async function setBlockNumber(world, from, governor, blockNumber) {
    return World_1.addAction(world, `Set Governor blockNumber to ${blockNumber.show()}`, await Invokation_1.invoke(world, governor.methods.setBlockNumber(blockNumber.encode()), from));
}
async function setBlockTimestamp(world, from, governor, blockTimestamp) {
    return World_1.addAction(world, `Set Governor blockTimestamp to ${blockTimestamp.show()}`, await Invokation_1.invoke(world, governor.methods.setBlockTimestamp(blockTimestamp.encode()), from));
}
function governorBravoCommands() {
    return [
        new Command_1.Command(`
        #### Deploy

        * "Deploy ...params" - Generates a new Governor
        * E.g. "Governor Deploy BravoDelegate"
      `, "Deploy", [new Command_1.Arg("params", CoreValue_1.getEventV, { variadic: true })], (world, from, { params }) => genGovernor(world, from, params.val)),
        new Command_1.Command(`
        #### Propose

        * "Governor <Governor> Propose description:<String> targets:<List> signatures:<List> callDataArgs:<List>" - Creates a new proposal in Governor
        * E.g. "Governor GovernorScenario Propose "New Interest Rate" [(Address cDAI)] [0] [("_setInterestRateModel(address)")] [[(Address MyInterestRateModel)]]
      `, "Propose", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("description", CoreValue_1.getStringV),
            new Command_1.Arg("targets", CoreValue_1.getArrayV(CoreValue_1.getAddressV)),
            new Command_1.Arg("values", CoreValue_1.getArrayV(CoreValue_1.getNumberV)),
            new Command_1.Arg("signatures", CoreValue_1.getArrayV(CoreValue_1.getStringV)),
            new Command_1.Arg("callDataArgs", CoreValue_1.getArrayV(CoreValue_1.getArrayV(CoreValue_1.getCoreValue))),
        ], async (world, from, { governor, description, targets, values, signatures, callDataArgs }) => {
            const targetsU = targets.val.map((a) => a.val);
            const valuesU = values.val.map((a) => a.encode());
            const signaturesU = signatures.val.map((a) => a.val);
            const callDatasU = signatures.val.reduce((acc, cur, idx) => {
                const args = Utils_1.rawValues(callDataArgs.val[idx]);
                acc.push(Utils_1.encodeParameters(world, cur.val, args));
                return acc;
            }, []);
            return await propose(world, from, governor, targetsU, valuesU, signaturesU, callDatasU, description.val);
        }, { namePos: 1 }),
        new Command_1.Command(`
        #### Proposal

        * "GovernorBravo <Governor> Proposal <...proposalEvent>" - Returns information about a proposal
        * E.g. "GovernorBravo GovernorScenario Proposal LastProposal Vote For"
      `, "Proposal", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("params", CoreValue_1.getEventV, { variadic: true }),
        ], (world, from, { governor, params }) => BravoProposalEvent_1.processProposalEvent(world, governor, params.val, from), { namePos: 1 }),
        new Command_1.Command(`
        #### SetBlockNumber

        * "Governor <Governor> SetBlockNumber <Seconds>" - Sets the blockNumber of the Governance Harness
        * E.g. "GovernorBravo SetBlockNumber 500"
    `, "SetBlockNumber", [new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV), new Command_1.Arg("blockNumber", CoreValue_1.getNumberV)], (world, from, { governor, blockNumber }) => setBlockNumber(world, from, governor, blockNumber), { namePos: 1 }),
        new Command_1.Command(`
        #### SetBlockTimestamp

        * "Governor <Governor> SetBlockNumber <Seconds>" - Sets the blockTimestamp of the Governance Harness
        * E.g. "GovernorBravo GovernorScenario SetBlockTimestamp 500"
    `, "SetBlockTimestamp", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("blockTimestamp", CoreValue_1.getNumberV),
        ], (world, from, { governor, blockTimestamp }) => setBlockTimestamp(world, from, governor, blockTimestamp), { namePos: 1 }),
        new Command_1.Command(`
        #### SetVotingDelay

        * "GovernorBravo <Governor> SetVotingDelay <Blocks>" - Sets the voting delay of the GovernorBravo
        * E.g. "GovernorBravo GovernorBravoScenario SetVotingDelay 2"
    `, "SetVotingDelay", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("newVotingDelay", CoreValue_1.getNumberV),
        ], (world, from, { governor, newVotingDelay }) => setVotingDelay(world, from, governor, newVotingDelay), { namePos: 1 }),
        new Command_1.Command(`
        #### SetVotingPeriod

        * "GovernorBravo <Governor> SetVotingPeriod <Blocks>" - Sets the voting period of the GovernorBravo
        * E.g. "GovernorBravo GovernorBravoScenario SetVotingPeriod 500"
    `, "SetVotingPeriod", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("newVotingPeriod", CoreValue_1.getNumberV),
        ], (world, from, { governor, newVotingPeriod }) => setVotingPeriod(world, from, governor, newVotingPeriod), { namePos: 1 }),
        new Command_1.Command(`
        #### SetProposalThreshold

        * "GovernorBravo <Governor> SetProposalThreshold <Comp>" - Sets the proposal threshold of the GovernorBravo
        * E.g. "GovernorBravo GovernorBravoScenario SetProposalThreshold 500e18"
    `, "SetProposalThreshold", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("newProposalThreshold", CoreValue_1.getNumberV),
        ], (world, from, { governor, newProposalThreshold }) => setProposalThreshold(world, from, governor, newProposalThreshold), { namePos: 1 }),
        new Command_1.Command(`
        #### Initiate

        * "GovernorBravo <Governor> Initiate <AddressV>" - Initiates the Governor relieving the given GovernorAlpha
        * E.g. "GovernorBravo GovernorBravoScenario Initiate (Address GovernorAlpha)"
    `, "Initiate", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("governorAlpha", CoreValue_1.getAddressV),
        ], (world, from, { governor, governorAlpha }) => initiate(world, from, governor, governorAlpha.val), { namePos: 1 }),
        new Command_1.Command(`
        #### HarnessInitiate

        * "GovernorBravo <Governor> HarnessInitiate" - Uses harness function to bypass initiate for testing
        * E.g. "GovernorBravo GovernorBravoScenario HarnessInitiate"
    `, "HarnessInitiate", [new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV)], (world, from, { governor }) => harnessInitiate(world, from, governor), { namePos: 1 }),
        new Command_1.Command(`
        #### SetImplementation

        * "GovernorBravo <Governor> SetImplementation <Governor>" - Sets the address for the GovernorBravo implementation
        * E.g. "GovernorBravo GovernorBravoScenario SetImplementation newImplementation"
    `, "SetImplementation", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("newImplementation", GovernorBravoValue_1.getGovernorV),
        ], (world, from, { governor, newImplementation }) => setImplementation(world, from, governor, newImplementation), { namePos: 1 }),
        new Command_1.Command(`
        #### SetPendingAdmin

        * "GovernorBravo <Governor> SetPendingAdmin <AddressV>" - Sets the address for the GovernorBravo pending admin
        * E.g. "GovernorBravo GovernorBravoScenario SetPendingAdmin newAdmin"
    `, "SetPendingAdmin", [
            new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("newPendingAdmin", CoreValue_1.getAddressV),
        ], (world, from, { governor, newPendingAdmin }) => setPendingAdmin(world, from, governor, newPendingAdmin.val), { namePos: 1 }),
        new Command_1.Command(`
        #### AcceptAdmin

        * "GovernorBravo <Governor> AcceptAdmin" - Pending admin accepts the admin role
        * E.g. "GovernorBravo GovernorBravoScenario AcceptAdmin"
    `, "AcceptAdmin", [new Command_1.Arg("governor", GovernorBravoValue_1.getGovernorV)], (world, from, { governor }) => acceptAdmin(world, from, governor), { namePos: 1 }),
        new Command_1.Command(`#### MergeABI

        * "ComptrollerImpl <Impl> MergeABI" - Merges the ABI, as if it was a become.
        * E.g. "ComptrollerImpl MyImpl MergeABI
      `, "MergeABI", [
            new Command_1.Arg("governorDelegator", GovernorBravoValue_1.getGovernorV),
            new Command_1.Arg("governorDelegate", GovernorBravoValue_1.getGovernorV),
        ], (world, from, { governorDelegator, governorDelegate }) => mergeABI(world, from, governorDelegator, governorDelegate), { namePos: 1 }),
    ];
}
exports.governorBravoCommands = governorBravoCommands;
async function processGovernorBravoEvent(world, event, from) {
    return await Command_1.processCommandEvent("Governor", governorBravoCommands(), world, event, from);
}
exports.processGovernorBravoEvent = processGovernorBravoEvent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiR292ZXJub3JCcmF2b0V2ZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0V2ZW50L0dvdmVybm9yQnJhdm9FdmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxvQ0FBNEM7QUFFNUMsMEVBQWdFO0FBQ2hFLDhDQUF1QztBQUN2Qyw0Q0FPc0I7QUFFdEIsd0NBQXFFO0FBQ3JFLHNDQUFtQztBQUVuQyw2REFBNEQ7QUFDNUQsb0NBQXVEO0FBQ3ZELG9FQUEyRDtBQUMzRCwwQ0FBK0M7QUFFL0MsS0FBSyxVQUFVLFdBQVcsQ0FDeEIsS0FBWSxFQUNaLElBQVksRUFDWixNQUFhO0lBRWIsSUFBSSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxHQUFHLE1BQU0sb0NBQWEsQ0FDL0QsS0FBSyxFQUNMLElBQUksRUFDSixNQUFNLENBQ1AsQ0FBQztJQUNGLEtBQUssR0FBRyxTQUFTLENBQUM7SUFFbEIsT0FBTyxpQkFBUyxDQUNkLEtBQUssRUFDTCwwQkFBMEIsT0FBTyxDQUFDLFFBQVEsZUFBZSxRQUFRLENBQUMsUUFBUSxFQUFFLEVBQzVFLE9BQU8sQ0FBQyxVQUFVLENBQ25CLENBQUM7QUFDSixDQUFDO0FBRUQsS0FBSyxVQUFVLGNBQWMsQ0FDM0IsS0FBWSxFQUNaLFFBQXVCLEVBQ3ZCLE1BQWMsRUFDZCxTQUFpQixFQUNqQixZQUFvQjtJQUVwQixJQUFJLEtBQUssQ0FBQyxjQUFjLEVBQUUsRUFBRTtRQUMxQixLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FDckIsa0RBQWtELEtBQUssQ0FBQyxPQUFPLEdBQUcsQ0FDbkUsQ0FBQztLQUNIO1NBQU07UUFDTCxNQUFNLGVBQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0tBQ3pFO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQs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RSxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsRUFDakUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQ2Y7UUFFRCxJQUFJLGlCQUFPLENBSVQ7Ozs7T0FJQyxFQUNELFVBQVUsRUFDVjtZQUNFLElBQUksYUFBRyxDQUFDLG1CQUFtQixFQUFFLGlDQUFZLENBQUM7WUFDMUMsSUFBSSxhQUFHLENBQUMsa0JBQWtCLEVBQUUsaUNBQVksQ0FBQztTQUMxQyxFQUNELENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLEVBQUUsRUFBRSxDQUN2RCxRQUFRLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxnQkFBZ0IsQ0FBQyxFQUM1RCxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FDZjtLQUNGLENBQUM7QUFDSixDQUFDO0FBelBELHNEQXlQQztBQUVNLEtBQUssVUFBVSx5QkFBeUIsQ0FDN0MsS0FBWSxFQUNaLEtBQVksRUFDWixJQUFtQjtJQUVuQixPQUFPLE1BQU0sNkJBQW1CLENBQzlCLFVBQVUsRUFDVixxQkFBcUIsRUFBRSxFQUN2QixLQUFLLEVBQ0wsS0FBSyxFQUNMLElBQUksQ0FDTCxDQUFDO0FBQ0osQ0FBQztBQVpELDhEQVlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnQgfSBmcm9tIFwiLi4vRXZlbnRcIjtcbmltcG9ydCB7IGFkZEFjdGlvbiwgV29ybGQgfSBmcm9tIFwiLi4vV29ybGRcIjtcbmltcG9ydCB7IEdvdmVybm9yQnJhdm8gfSBmcm9tIFwiLi4vQ29udHJhY3QvR292ZXJub3JCcmF2b1wiO1xuaW1wb3J0IHsgYnVpbGRHb3Zlcm5vciB9IGZyb20gXCIuLi9CdWlsZGVyL0dvdmVybm9yQnJhdm9CdWlsZGVyXCI7XG5pbXBvcnQgeyBpbnZva2UgfSBmcm9tIFwiLi4vSW52b2thdGlvblwiO1xuaW1wb3J0IHtcbiAgZ2V0QWRkcmVzc1YsXG4gIGdldEFycmF5VixcbiAgZ2V0RXZlbnRWLFxuICBnZXROdW1iZXJWLFxuICBnZXRTdHJpbmdWLFxuICBnZXRDb3JlVmFsdWUsXG59IGZyb20gXCIuLi9Db3JlVmFsdWVcIjtcbmltcG9ydCB7IEFkZHJlc3NWLCBBcnJheVYsIEV2ZW50ViwgTnVtYmVyViwgU3RyaW5nViB9IGZyb20gXCIuLi9WYWx1ZVwiO1xuaW1wb3J0IHsgQXJnLCBDb21tYW5kLCBwcm9jZXNzQ29tbWFuZEV2ZW50LCBWaWV3IH0gZnJvbSBcIi4uL0NvbW1hbmRcIjtcbmltcG9ydCB7IHZlcmlmeSB9IGZyb20gXCIuLi9WZXJpZnlcIjtcbmltcG9ydCB7IGVuY29kZWROdW1iZXIgfSBmcm9tIFwiLi4vRW5jb2RpbmdcIjtcbmltcG9ydCB7IHByb2Nlc3NQcm9wb3NhbEV2ZW50IH0gZnJvbSBcIi4vQnJhdm9Qcm9wb3NhbEV2ZW50XCI7XG5pbXBvcnQgeyBlbmNvZGVQYXJhbWV0ZXJzLCByYXdWYWx1ZXMgfSBmcm9tIFwiLi4vVXRpbHNcIjtcbmltcG9ydCB7IGdldEdvdmVybm9yViB9IGZyb20gXCIuLi9WYWx1ZS9Hb3Zlcm5vckJyYXZvVmFsdWVcIjtcbmltcG9ydCB7IG1lcmdlQ29udHJhY3RBQkkgfSBmcm9tIFwiLi4vTmV0d29ya3NcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2VuR292ZXJub3IoXG4gIHdvcmxkOiBXb3JsZCxcbiAgZnJvbTogc3RyaW5nLFxuICBwYXJhbXM6IEV2ZW50XG4pOiBQcm9taXNlPFdvcmxkPiB7XG4gIGxldCB7IHdvcmxkOiBuZXh0V29ybGQsIGdvdmVybm9yLCBnb3ZEYXRhIH0gPSBhd2FpdCBidWlsZEdvdmVybm9yKFxuICAgIHdvcmxkLFxuICAgIGZyb20sXG4gICAgcGFyYW1zXG4gICk7XG4gIHdvcmxkID0gbmV4dFdvcmxkO1xuXG4gIHJldHVybiBhZGRBY3Rpb24oXG4gICAgd29ybGQsXG4gICAgYERlcGxveWVkIEdvdmVybm9yQnJhdm8gJHtnb3ZEYXRhLmNvbnRyYWN0fSB0byBhZGRyZXNzICR7Z292ZXJub3IuX2FkZHJlc3N9YCxcbiAgICBnb3ZEYXRhLmludm9rYXRpb25cbiAgKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5R292ZXJub3IoXG4gIHdvcmxkOiBXb3JsZCxcbiAgZ292ZXJub3I6IEdvdmVybm9yQnJhdm8sXG4gIGFwaUtleTogc3RyaW5nLFxuICBtb2RlbE5hbWU6IHN0cmluZyxcbiAgY29udHJhY3ROYW1lOiBzdHJpbmdcbik6IFByb21pc2U8V29ybGQ+IHtcbiAgaWYgKHdvcmxkLmlzTG9jYWxOZXR3b3JrKCkpIHtcbiAgICB3b3JsZC5wcmludGVyLnByaW50TGluZShcbiAgICAgIGBQb2xpdGVseSBkZWNsaW5pbmcgdG8gdmVyaWZ5IG9uIGxvY2FsIG5ldHdvcms6ICR7d29ybGQubmV0d29ya30uYFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgdmVyaWZ5KHdvcmxkLCBhcGlLZXksIG1vZGVsTmFtZSwgY29udHJhY3ROYW1lLCBnb3Zlcm5vci5fYWRkcmVzcyk7XG4gIH1cblxuICByZXR1cm4gd29ybGQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIG1lcmdlQUJJKFxuICB3b3JsZDogV29ybGQsXG4gIGZyb206IHN0cmluZyxcbiAgZ292ZXJub3JEZWxlZ2F0b3I6IEdvdmVybm9yQnJhdm8sXG4gIGdvdmVybm9yRGVsZWdhdGU6IEdvdmVybm9yQnJhdm9cbik6IFByb21pc2U8V29ybGQ+IHtcbiAgaWYgKCF3b3JsZC5kcnlSdW4pIHtcbiAgICAvLyBTa2lwIHRoaXMgc3BlY2lmaWNhbGx5IG9uIGRyeSBydW5zIHNpbmNlIGl0J3MgbGlrZWx5IHRvIGNyYXNoIGR1ZSB0byBhIG51bWJlciBvZiByZWFzb25zXG4gICAgd29ybGQgPSBhd2FpdCBtZXJnZUNvbnRyYWN0QUJJKFxuICAgICAgd29ybGQsXG4gICAgICBcIkJyYXZvRGVsZWdhdG9yXCIsXG4gICAgICBnb3Zlcm5vckRlbGVnYXRvcixcbiAgICAgIGdvdmVybm9yRGVsZWdhdG9yLm5hbWUsXG4gICAgICBnb3Zlcm5vckRlbGVnYXRlLm5hbWVcbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBwcm9wb3NlKFxuICB3b3JsZDogV29ybGQsXG4gIGZyb206IHN0cmluZyxcbiAgZ292ZXJub3I6IEdvdmVybm9yQnJhdm8sXG4gIHRhcmdldHM6IHN0cmluZ1tdLFxuICB2YWx1ZXM6IGVuY29kZWROdW1iZXJbXSxcbiAgc2lnbmF0dXJlczogc3RyaW5nW10sXG4gIGNhbGxkYXRhczogc3RyaW5nW10sXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmdcbik6IFByb21pc2U8V29ybGQ+IHtcbiAgY29uc3QgaW52b2thdGlvbiA9IGF3YWl0IGludm9rZShcbiAgICB3b3JsZCxcbiAgICBnb3Zlcm5vci5tZXRob2RzLnByb3Bvc2UoXG4gICAgICB0YXJnZXRzLFxuICAgICAgdmFsdWVzLFxuICAgICAgc2lnbmF0dXJlcyxcbiAgICAgIGNhbGxkYXRhcyxcbiAgICAgIGRlc2NyaXB0aW9uXG4gICAgKSxcbiAgICBmcm9tXG4gICk7XG4gIHJldHVybiBhZGRBY3Rpb24oXG4gICAgd29ybGQsXG4gICAgYENyZWF0ZWQgbmV3IHByb3Bvc2FsIFwiJHtkZXNjcmlwdGlvbn1cIiB3aXRoIGlkPSR7aW52b2thdGlvbi52YWx1ZX0gaW4gR292ZXJub3JgLFxuICAgIGludm9rYXRpb25cbiAgKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0Vm90aW5nRGVsYXkoXG4gIHdvcmxkOiBXb3JsZCxcbiAgZnJvbTogc3RyaW5nLFxuICBnb3Zlcm5vcjogR292ZXJub3JCcmF2byxcbiAgbmV3Vm90aW5nRGVsYXk6IE51bWJlclZcbik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2UoXG4gICAgd29ybGQsXG4gICAgZ292ZXJub3IubWV0aG9kcy5fc2V0Vm90aW5nRGVsYXkobmV3Vm90aW5nRGVsYXkuZW5jb2RlKCkpLFxuICAgIGZyb21cbiAgKTtcblxuICB3b3JsZCA9IGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgU2V0IHZvdGluZyBkZWxheSB0byAke25ld1ZvdGluZ0RlbGF5LnNob3coKX1gLFxuICAgIGludm9rYXRpb25cbiAgKTtcblxuICByZXR1cm4gd29ybGQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNldFZvdGluZ1BlcmlvZChcbiAgd29ybGQ6IFdvcmxkLFxuICBmcm9tOiBzdHJpbmcsXG4gIGdvdmVybm9yOiBHb3Zlcm5vckJyYXZvLFxuICBuZXdWb3RpbmdQZXJpb2Q6IE51bWJlclZcbik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2UoXG4gICAgd29ybGQsXG4gICAgZ292ZXJub3IubWV0aG9kcy5fc2V0Vm90aW5nUGVyaW9kKG5ld1ZvdGluZ1BlcmlvZC5lbmNvZGUoKSksXG4gICAgZnJvbVxuICApO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBTZXQgdm90aW5nIHBlcmlvZCB0byAke25ld1ZvdGluZ1BlcmlvZC5zaG93KCl9YCxcbiAgICBpbnZva2F0aW9uXG4gICk7XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRQcm9wb3NhbFRocmVzaG9sZChcbiAgd29ybGQ6IFdvcmxkLFxuICBmcm9tOiBzdHJpbmcsXG4gIGdvdmVybm9yOiBHb3Zlcm5vckJyYXZvLFxuICBuZXdQcm9wb3NhbFRocmVzaG9sZDogTnVtYmVyVlxuKTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQgaW52b2thdGlvbiA9IGF3YWl0IGludm9rZShcbiAgICB3b3JsZCxcbiAgICBnb3Zlcm5vci5tZXRob2RzLl9zZXRQcm9wb3NhbFRocmVzaG9sZChuZXdQcm9wb3NhbFRocmVzaG9sZC5lbmNvZGUoKSksXG4gICAgZnJvbVxuICApO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBTZXQgcHJvcG9zYWwgdGhyZXNob2xkIHRvICR7bmV3UHJvcG9zYWxUaHJlc2hvbGQuc2hvdygpfWAsXG4gICAgaW52b2thdGlvblxuICApO1xuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0SW1wbGVtZW50YXRpb24oXG4gIHdvcmxkOiBXb3JsZCxcbiAgZnJvbTogc3RyaW5nLFxuICBnb3Zlcm5vcjogR292ZXJub3JCcmF2byxcbiAgbmV3SW1wbGVtZW50YXRpb246IEdvdmVybm9yQnJhdm9cbik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2UoXG4gICAgd29ybGQsXG4gICAgZ292ZXJub3IubWV0aG9kcy5fc2V0SW1wbGVtZW50YXRpb24obmV3SW1wbGVtZW50YXRpb24uX2FkZHJlc3MpLFxuICAgIGZyb21cbiAgKTtcblxuICB3b3JsZCA9IGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgU2V0IEdvdmVybm9yQnJhdm8gaW1wbGVtZW50YXRpb24gdG8gJHtuZXdJbXBsZW1lbnRhdGlvbn1gLFxuICAgIGludm9rYXRpb25cbiAgKTtcblxuICBtZXJnZUFCSSh3b3JsZCwgZnJvbSwgZ292ZXJub3IsIG5ld0ltcGxlbWVudGF0aW9uKVxuXG4gIHJldHVybiB3b3JsZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gaW5pdGlhdGUoXG4gIHdvcmxkOiBXb3JsZCxcbiAgZnJvbTogc3RyaW5nLFxuICBnb3Zlcm5vcjogR292ZXJub3JCcmF2byxcbiAgZ292ZXJub3JBbHBoYTogc3RyaW5nXG4pOiBQcm9taXNlPFdvcmxkPiB7XG4gIGxldCBpbnZva2F0aW9uID0gYXdhaXQgaW52b2tlKFxuICAgIHdvcmxkLFxuICAgIGdvdmVybm9yLm1ldGhvZHMuX2luaXRpYXRlKGdvdmVybm9yQWxwaGEpLFxuICAgIGZyb21cbiAgKTtcblxuICB3b3JsZCA9IGFkZEFjdGlvbihcbiAgICB3b3JsZCxcbiAgICBgSW5pdGlhdGVkIGdvdmVybm9yIGZyb20gR292ZXJub3JBbHBoYSBhdCAke2dvdmVybm9yQWxwaGF9YCxcbiAgICBpbnZva2F0aW9uXG4gICk7XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBoYXJuZXNzSW5pdGlhdGUoXG4gIHdvcmxkOiBXb3JsZCxcbiAgZnJvbTogc3RyaW5nLFxuICBnb3Zlcm5vcjogR292ZXJub3JCcmF2b1xuKTogUHJvbWlzZTxXb3JsZD4ge1xuICBsZXQgaW52b2thdGlvbiA9IGF3YWl0IGludm9rZSh3b3JsZCwgZ292ZXJub3IubWV0aG9kcy5faW5pdGlhdGUoKSwgZnJvbSk7XG5cbiAgd29ybGQgPSBhZGRBY3Rpb24oXG4gICAgd29ybGQsXG4gICAgYEluaXRpYXRlZCBnb3Zlcm5vciB1c2luZyBoYXJuZXNzIGZ1bmN0aW9uYCxcbiAgICBpbnZva2F0aW9uXG4gICk7XG5cbiAgcmV0dXJuIHdvcmxkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRQZW5kaW5nQWRtaW4oXG4gIHdvcmxkOiBXb3JsZCxcbiAgZnJvbTogc3RyaW5nLFxuICBnb3Zlcm5vcjogR292ZXJub3JCcmF2byxcbiAgbmV3UGVuZGluZ0FkbWluOiBzdHJpbmdcbik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2UoXG4gICAgd29ybGQsXG4gICAgZ292ZXJub3IubWV0aG9kcy5fc2V0UGVuZGluZ0FkbWluKG5ld1BlbmRpbmdBZG1pbiksXG4gICAgZnJvbVxuICApO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBHb3Zlcm5vciBwZW5kaW5nIGFkbWluIHNldCB0byAke25ld1BlbmRpbmdBZG1pbn1gLFxuICAgIGludm9rYXRpb25cbiAgKTtcblxuICByZXR1cm4gd29ybGQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFjY2VwdEFkbWluKFxuICB3b3JsZDogV29ybGQsXG4gIGZyb206IHN0cmluZyxcbiAgZ292ZXJub3I6IEdvdmVybm9yQnJhdm9cbik6IFByb21pc2U8V29ybGQ+IHtcbiAgbGV0IGludm9rYXRpb24gPSBhd2FpdCBpbnZva2Uod29ybGQsIGdvdmVybm9yLm1ldGhvZHMuX2FjY2VwdEFkbWluKCksIGZyb20pO1xuXG4gIHdvcmxkID0gYWRkQWN0aW9uKHdvcmxkLCBgR292ZXJub3IgYWRtaW4gYWNjZXB0ZWRgLCBpbnZva2F0aW9uKTtcblxuICByZXR1cm4gd29ybGQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNldEJsb2NrTnVtYmVyKFxuICB3b3JsZDogV29ybGQsXG4gIGZyb206IHN0cmluZyxcbiAgZ292ZXJub3I6IEdvdmVybm9yQnJhdm8sXG4gIGJsb2NrTnVtYmVyOiBOdW1iZXJWXG4pOiBQcm9taXNlPFdvcmxkPiB7XG4gIHJldHVybiBhZGRBY3Rpb24oXG4gICAgd29ybGQsXG4gICAgYFNldCBHb3Zlcm5vciBibG9ja051bWJlciB0byAke2Jsb2NrTnVtYmVyLnNob3coKX1gLFxuICAgIGF3YWl0IGludm9rZShcbiAgICAgIHdvcmxkLFxuICAgICAgZ292ZXJub3IubWV0aG9kcy5zZXRCbG9ja051bWJlcihibG9ja051bWJlci5lbmNvZGUoKSksXG4gICAgICBmcm9tXG4gICAgKVxuICApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRCbG9ja1RpbWVzdGFtcChcbiAgd29ybGQ6IFdvcmxkLFxuICBmcm9tOiBzdHJpbmcsXG4gIGdvdmVybm9yOiBHb3Zlcm5vckJyYXZvLFxuICBibG9ja1RpbWVzdGFtcDogTnVtYmVyVlxuKTogUHJvbWlzZTxXb3JsZD4ge1xuICByZXR1cm4gYWRkQWN0aW9uKFxuICAgIHdvcmxkLFxuICAgIGBTZXQgR292ZXJub3IgYmxvY2tUaW1lc3RhbXAgdG8gJHtibG9ja1RpbWVzdGFtcC5zaG93KCl9YCxcbiAgICBhd2FpdCBpbnZva2UoXG4gICAgICB3b3JsZCxcbiAgICAgIGdvdmVybm9yLm1ldGhvZHMuc2V0QmxvY2tUaW1lc3RhbXAoYmxvY2tUaW1lc3RhbXAuZW5jb2RlKCkpLFxuICAgICAgZnJvbVxuICAgIClcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdvdmVybm9yQnJhdm9Db21tYW5kcygpIHtcbiAgcmV0dXJuIFtcbiAgICBuZXcgQ29tbWFuZDx7IHBhcmFtczogRXZlbnRWIH0+KFxuICAgICAgYFxuICAgICAgICAjIyMjIERlcGxveVxuXG4gICAgICAgICogXCJEZXBsb3kgLi4ucGFyYW1zXCIgLSBHZW5lcmF0ZXMgYSBuZXcgR292ZXJub3JcbiAgICAgICAgKiBFLmcuIFwiR292ZXJub3IgRGVwbG95IEJyYXZvRGVsZWdhdGVcIlxuICAgICAgYCxcbiAgICAgIFwiRGVwbG95XCIsXG4gICAgICBbbmV3IEFyZyhcInBhcmFtc1wiLCBnZXRFdmVudFYsIHsgdmFyaWFkaWM6IHRydWUgfSldLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7IHBhcmFtcyB9KSA9PiBnZW5Hb3Zlcm5vcih3b3JsZCwgZnJvbSwgcGFyYW1zLnZhbClcbiAgICApLFxuXG4gICAgbmV3IENvbW1hbmQ8e1xuICAgICAgZ292ZXJub3I6IEdvdmVybm9yQnJhdm87XG4gICAgICBkZXNjcmlwdGlvbjogU3RyaW5nVjtcbiAgICAgIHRhcmdldHM6IEFycmF5VjxBZGRyZXNzVj47XG4gICAgICB2YWx1ZXM6IEFycmF5VjxOdW1iZXJWPjtcbiAgICAgIHNpZ25hdHVyZXM6IEFycmF5VjxTdHJpbmdWPjtcbiAgICAgIGNhbGxEYXRhQXJnczogQXJyYXlWPEFycmF5VjxTdHJpbmdWPj47XG4gICAgfT4oXG4gICAgICBgXG4gICAgICAgICMjIyMgUHJvcG9zZVxuXG4gICAgICAgICogXCJHb3Zlcm5vciA8R292ZXJub3I+IFByb3Bvc2UgZGVzY3JpcHRpb246PFN0cmluZz4gdGFyZ2V0czo8TGlzdD4gc2lnbmF0dXJlczo8TGlzdD4gY2FsbERhdGFBcmdzOjxMaXN0PlwiIC0gQ3JlYXRlcyBhIG5ldyBwcm9wb3NhbCBpbiBHb3Zlcm5vclxuICAgICAgICAqIEUuZy4gXCJHb3Zlcm5vciBHb3Zlcm5vclNjZW5hcmlvIFByb3Bvc2UgXCJOZXcgSW50ZXJlc3QgUmF0ZVwiIFsoQWRkcmVzcyBjREFJKV0gWzBdIFsoXCJfc2V0SW50ZXJlc3RSYXRlTW9kZWwoYWRkcmVzcylcIildIFtbKEFkZHJlc3MgTXlJbnRlcmVzdFJhdGVNb2RlbCldXVxuICAgICAgYCxcbiAgICAgIFwiUHJvcG9zZVwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiZ292ZXJub3JcIiwgZ2V0R292ZXJub3JWKSxcbiAgICAgICAgbmV3IEFyZyhcImRlc2NyaXB0aW9uXCIsIGdldFN0cmluZ1YpLFxuICAgICAgICBuZXcgQXJnKFwidGFyZ2V0c1wiLCBnZXRBcnJheVYoZ2V0QWRkcmVzc1YpKSxcbiAgICAgICAgbmV3IEFyZyhcInZhbHVlc1wiLCBnZXRBcnJheVYoZ2V0TnVtYmVyVikpLFxuICAgICAgICBuZXcgQXJnKFwic2lnbmF0dXJlc1wiLCBnZXRBcnJheVYoZ2V0U3RyaW5nVikpLFxuICAgICAgICBuZXcgQXJnKFwiY2FsbERhdGFBcmdzXCIsIGdldEFycmF5VihnZXRBcnJheVYoZ2V0Q29yZVZhbHVlKSkpLFxuICAgICAgXSxcbiAgICAgIGFzeW5jIChcbiAgICAgICAgd29ybGQsXG4gICAgICAgIGZyb20sXG4gICAgICAgIHsgZ292ZXJub3IsIGRlc2NyaXB0aW9uLCB0YXJnZXRzLCB2YWx1ZXMsIHNpZ25hdHVyZXMsIGNhbGxEYXRhQXJncyB9XG4gICAgICApID0+IHtcbiAgICAgICAgY29uc3QgdGFyZ2V0c1UgPSB0YXJnZXRzLnZhbC5tYXAoKGEpID0+IGEudmFsKTtcbiAgICAgICAgY29uc3QgdmFsdWVzVSA9IHZhbHVlcy52YWwubWFwKChhKSA9PiBhLmVuY29kZSgpKTtcbiAgICAgICAgY29uc3Qgc2lnbmF0dXJlc1UgPSBzaWduYXR1cmVzLnZhbC5tYXAoKGEpID0+IGEudmFsKTtcbiAgICAgICAgY29uc3QgY2FsbERhdGFzVTogc3RyaW5nW10gPSBzaWduYXR1cmVzLnZhbC5yZWR1Y2UoKGFjYywgY3VyLCBpZHgpID0+IHtcbiAgICAgICAgICBjb25zdCBhcmdzID0gcmF3VmFsdWVzKGNhbGxEYXRhQXJncy52YWxbaWR4XSk7XG4gICAgICAgICAgYWNjLnB1c2goZW5jb2RlUGFyYW1ldGVycyh3b3JsZCwgY3VyLnZhbCwgYXJncykpO1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIDxzdHJpbmdbXT5bXSk7XG4gICAgICAgIHJldHVybiBhd2FpdCBwcm9wb3NlKFxuICAgICAgICAgIHdvcmxkLFxuICAgICAgICAgIGZyb20sXG4gICAgICAgICAgZ292ZXJub3IsXG4gICAgICAgICAgdGFyZ2V0c1UsXG4gICAgICAgICAgdmFsdWVzVSxcbiAgICAgICAgICBzaWduYXR1cmVzVSxcbiAgICAgICAgICBjYWxsRGF0YXNVLFxuICAgICAgICAgIGRlc2NyaXB0aW9uLnZhbFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcbiAgICBuZXcgQ29tbWFuZDx7IGdvdmVybm9yOiBHb3Zlcm5vckJyYXZvOyBwYXJhbXM6IEV2ZW50ViB9PihcbiAgICAgIGBcbiAgICAgICAgIyMjIyBQcm9wb3NhbFxuXG4gICAgICAgICogXCJHb3Zlcm5vckJyYXZvIDxHb3Zlcm5vcj4gUHJvcG9zYWwgPC4uLnByb3Bvc2FsRXZlbnQ+XCIgLSBSZXR1cm5zIGluZm9ybWF0aW9uIGFib3V0IGEgcHJvcG9zYWxcbiAgICAgICAgKiBFLmcuIFwiR292ZXJub3JCcmF2byBHb3Zlcm5vclNjZW5hcmlvIFByb3Bvc2FsIExhc3RQcm9wb3NhbCBWb3RlIEZvclwiXG4gICAgICBgLFxuICAgICAgXCJQcm9wb3NhbFwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiZ292ZXJub3JcIiwgZ2V0R292ZXJub3JWKSxcbiAgICAgICAgbmV3IEFyZyhcInBhcmFtc1wiLCBnZXRFdmVudFYsIHsgdmFyaWFkaWM6IHRydWUgfSksXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7IGdvdmVybm9yLCBwYXJhbXMgfSkgPT5cbiAgICAgICAgcHJvY2Vzc1Byb3Bvc2FsRXZlbnQod29ybGQsIGdvdmVybm9yLCBwYXJhbXMudmFsLCBmcm9tKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcbiAgICBuZXcgQ29tbWFuZDx7IGdvdmVybm9yOiBHb3Zlcm5vckJyYXZvOyBibG9ja051bWJlcjogTnVtYmVyViB9PihcbiAgICAgIGBcbiAgICAgICAgIyMjIyBTZXRCbG9ja051bWJlclxuXG4gICAgICAgICogXCJHb3Zlcm5vciA8R292ZXJub3I+IFNldEJsb2NrTnVtYmVyIDxTZWNvbmRzPlwiIC0gU2V0cyB0aGUgYmxvY2tOdW1iZXIgb2YgdGhlIEdvdmVybmFuY2UgSGFybmVzc1xuICAgICAgICAqIEUuZy4gXCJHb3Zlcm5vckJyYXZvIFNldEJsb2NrTnVtYmVyIDUwMFwiXG4gICAgYCxcbiAgICAgIFwiU2V0QmxvY2tOdW1iZXJcIixcbiAgICAgIFtuZXcgQXJnKFwiZ292ZXJub3JcIiwgZ2V0R292ZXJub3JWKSwgbmV3IEFyZyhcImJsb2NrTnVtYmVyXCIsIGdldE51bWJlclYpXSxcbiAgICAgICh3b3JsZCwgZnJvbSwgeyBnb3Zlcm5vciwgYmxvY2tOdW1iZXIgfSkgPT5cbiAgICAgICAgc2V0QmxvY2tOdW1iZXIod29ybGQsIGZyb20sIGdvdmVybm9yLCBibG9ja051bWJlciksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG4gICAgbmV3IENvbW1hbmQ8eyBnb3Zlcm5vcjogR292ZXJub3JCcmF2bzsgYmxvY2tUaW1lc3RhbXA6IE51bWJlclYgfT4oXG4gICAgICBgXG4gICAgICAgICMjIyMgU2V0QmxvY2tUaW1lc3RhbXBcblxuICAgICAgICAqIFwiR292ZXJub3IgPEdvdmVybm9yPiBTZXRCbG9ja051bWJlciA8U2Vjb25kcz5cIiAtIFNldHMgdGhlIGJsb2NrVGltZXN0YW1wIG9mIHRoZSBHb3Zlcm5hbmNlIEhhcm5lc3NcbiAgICAgICAgKiBFLmcuIFwiR292ZXJub3JCcmF2byBHb3Zlcm5vclNjZW5hcmlvIFNldEJsb2NrVGltZXN0YW1wIDUwMFwiXG4gICAgYCxcbiAgICAgIFwiU2V0QmxvY2tUaW1lc3RhbXBcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImdvdmVybm9yXCIsIGdldEdvdmVybm9yViksXG4gICAgICAgIG5ldyBBcmcoXCJibG9ja1RpbWVzdGFtcFwiLCBnZXROdW1iZXJWKSxcbiAgICAgIF0sXG4gICAgICAod29ybGQsIGZyb20sIHsgZ292ZXJub3IsIGJsb2NrVGltZXN0YW1wIH0pID0+XG4gICAgICAgIHNldEJsb2NrVGltZXN0YW1wKHdvcmxkLCBmcm9tLCBnb3Zlcm5vciwgYmxvY2tUaW1lc3RhbXApLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApLFxuXG4gICAgbmV3IENvbW1hbmQ8eyBnb3Zlcm5vcjogR292ZXJub3JCcmF2bzsgbmV3Vm90aW5nRGVsYXk6IE51bWJlclYgfT4oXG4gICAgICBgXG4gICAgICAgICMjIyMgU2V0Vm90aW5nRGVsYXlcblxuICAgICAgICAqIFwiR292ZXJub3JCcmF2byA8R292ZXJub3I+IFNldFZvdGluZ0RlbGF5IDxCbG9ja3M+XCIgLSBTZXRzIHRoZSB2b3RpbmcgZGVsYXkgb2YgdGhlIEdvdmVybm9yQnJhdm9cbiAgICAgICAgKiBFLmcuIFwiR292ZXJub3JCcmF2byBHb3Zlcm5vckJyYXZvU2NlbmFyaW8gU2V0Vm90aW5nRGVsYXkgMlwiXG4gICAgYCxcbiAgICAgIFwiU2V0Vm90aW5nRGVsYXlcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImdvdmVybm9yXCIsIGdldEdvdmVybm9yViksXG4gICAgICAgIG5ldyBBcmcoXCJuZXdWb3RpbmdEZWxheVwiLCBnZXROdW1iZXJWKSxcbiAgICAgIF0sXG4gICAgICAod29ybGQsIGZyb20sIHsgZ292ZXJub3IsIG5ld1ZvdGluZ0RlbGF5IH0pID0+XG4gICAgICAgIHNldFZvdGluZ0RlbGF5KHdvcmxkLCBmcm9tLCBnb3Zlcm5vciwgbmV3Vm90aW5nRGVsYXkpLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApLFxuICAgIG5ldyBDb21tYW5kPHsgZ292ZXJub3I6IEdvdmVybm9yQnJhdm87IG5ld1ZvdGluZ1BlcmlvZDogTnVtYmVyViB9PihcbiAgICAgIGBcbiAgICAgICAgIyMjIyBTZXRWb3RpbmdQZXJpb2RcblxuICAgICAgICAqIFwiR292ZXJub3JCcmF2byA8R292ZXJub3I+IFNldFZvdGluZ1BlcmlvZCA8QmxvY2tzPlwiIC0gU2V0cyB0aGUgdm90aW5nIHBlcmlvZCBvZiB0aGUgR292ZXJub3JCcmF2b1xuICAgICAgICAqIEUuZy4gXCJHb3Zlcm5vckJyYXZvIEdvdmVybm9yQnJhdm9TY2VuYXJpbyBTZXRWb3RpbmdQZXJpb2QgNTAwXCJcbiAgICBgLFxuICAgICAgXCJTZXRWb3RpbmdQZXJpb2RcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImdvdmVybm9yXCIsIGdldEdvdmVybm9yViksXG4gICAgICAgIG5ldyBBcmcoXCJuZXdWb3RpbmdQZXJpb2RcIiwgZ2V0TnVtYmVyViksXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7IGdvdmVybm9yLCBuZXdWb3RpbmdQZXJpb2QgfSkgPT5cbiAgICAgICAgc2V0Vm90aW5nUGVyaW9kKHdvcmxkLCBmcm9tLCBnb3Zlcm5vciwgbmV3Vm90aW5nUGVyaW9kKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcbiAgICBuZXcgQ29tbWFuZDx7IGdvdmVybm9yOiBHb3Zlcm5vckJyYXZvOyBuZXdQcm9wb3NhbFRocmVzaG9sZDogTnVtYmVyViB9PihcbiAgICAgIGBcbiAgICAgICAgIyMjIyBTZXRQcm9wb3NhbFRocmVzaG9sZFxuXG4gICAgICAgICogXCJHb3Zlcm5vckJyYXZvIDxHb3Zlcm5vcj4gU2V0UHJvcG9zYWxUaHJlc2hvbGQgPENvbXA+XCIgLSBTZXRzIHRoZSBwcm9wb3NhbCB0aHJlc2hvbGQgb2YgdGhlIEdvdmVybm9yQnJhdm9cbiAgICAgICAgKiBFLmcuIFwiR292ZXJub3JCcmF2byBHb3Zlcm5vckJyYXZvU2NlbmFyaW8gU2V0UHJvcG9zYWxUaHJlc2hvbGQgNTAwZTE4XCJcbiAgICBgLFxuICAgICAgXCJTZXRQcm9wb3NhbFRocmVzaG9sZFwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiZ292ZXJub3JcIiwgZ2V0R292ZXJub3JWKSxcbiAgICAgICAgbmV3IEFyZyhcIm5ld1Byb3Bvc2FsVGhyZXNob2xkXCIsIGdldE51bWJlclYpLFxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgZnJvbSwgeyBnb3Zlcm5vciwgbmV3UHJvcG9zYWxUaHJlc2hvbGQgfSkgPT5cbiAgICAgICAgc2V0UHJvcG9zYWxUaHJlc2hvbGQod29ybGQsIGZyb20sIGdvdmVybm9yLCBuZXdQcm9wb3NhbFRocmVzaG9sZCksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG4gICAgbmV3IENvbW1hbmQ8eyBnb3Zlcm5vcjogR292ZXJub3JCcmF2bzsgZ292ZXJub3JBbHBoYTogQWRkcmVzc1YgfT4oXG4gICAgICBgXG4gICAgICAgICMjIyMgSW5pdGlhdGVcblxuICAgICAgICAqIFwiR292ZXJub3JCcmF2byA8R292ZXJub3I+IEluaXRpYXRlIDxBZGRyZXNzVj5cIiAtIEluaXRpYXRlcyB0aGUgR292ZXJub3IgcmVsaWV2aW5nIHRoZSBnaXZlbiBHb3Zlcm5vckFscGhhXG4gICAgICAgICogRS5nLiBcIkdvdmVybm9yQnJhdm8gR292ZXJub3JCcmF2b1NjZW5hcmlvIEluaXRpYXRlIChBZGRyZXNzIEdvdmVybm9yQWxwaGEpXCJcbiAgICBgLFxuICAgICAgXCJJbml0aWF0ZVwiLFxuICAgICAgW1xuICAgICAgICBuZXcgQXJnKFwiZ292ZXJub3JcIiwgZ2V0R292ZXJub3JWKSxcbiAgICAgICAgbmV3IEFyZyhcImdvdmVybm9yQWxwaGFcIiwgZ2V0QWRkcmVzc1YpLFxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgZnJvbSwgeyBnb3Zlcm5vciwgZ292ZXJub3JBbHBoYSB9KSA9PlxuICAgICAgICBpbml0aWF0ZSh3b3JsZCwgZnJvbSwgZ292ZXJub3IsIGdvdmVybm9yQWxwaGEudmFsKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcbiAgICBuZXcgQ29tbWFuZDx7IGdvdmVybm9yOiBHb3Zlcm5vckJyYXZvIH0+KFxuICAgICAgYFxuICAgICAgICAjIyMjIEhhcm5lc3NJbml0aWF0ZVxuXG4gICAgICAgICogXCJHb3Zlcm5vckJyYXZvIDxHb3Zlcm5vcj4gSGFybmVzc0luaXRpYXRlXCIgLSBVc2VzIGhhcm5lc3MgZnVuY3Rpb24gdG8gYnlwYXNzIGluaXRpYXRlIGZvciB0ZXN0aW5nXG4gICAgICAgICogRS5nLiBcIkdvdmVybm9yQnJhdm8gR292ZXJub3JCcmF2b1NjZW5hcmlvIEhhcm5lc3NJbml0aWF0ZVwiXG4gICAgYCxcbiAgICAgIFwiSGFybmVzc0luaXRpYXRlXCIsXG4gICAgICBbbmV3IEFyZyhcImdvdmVybm9yXCIsIGdldEdvdmVybm9yVildLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7IGdvdmVybm9yIH0pID0+IGhhcm5lc3NJbml0aWF0ZSh3b3JsZCwgZnJvbSwgZ292ZXJub3IpLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApLFxuICAgIG5ldyBDb21tYW5kPHsgZ292ZXJub3I6IEdvdmVybm9yQnJhdm87IG5ld0ltcGxlbWVudGF0aW9uOiBHb3Zlcm5vckJyYXZvIH0+KFxuICAgICAgYFxuICAgICAgICAjIyMjIFNldEltcGxlbWVudGF0aW9uXG5cbiAgICAgICAgKiBcIkdvdmVybm9yQnJhdm8gPEdvdmVybm9yPiBTZXRJbXBsZW1lbnRhdGlvbiA8R292ZXJub3I+XCIgLSBTZXRzIHRoZSBhZGRyZXNzIGZvciB0aGUgR292ZXJub3JCcmF2byBpbXBsZW1lbnRhdGlvblxuICAgICAgICAqIEUuZy4gXCJHb3Zlcm5vckJyYXZvIEdvdmVybm9yQnJhdm9TY2VuYXJpbyBTZXRJbXBsZW1lbnRhdGlvbiBuZXdJbXBsZW1lbnRhdGlvblwiXG4gICAgYCxcbiAgICAgIFwiU2V0SW1wbGVtZW50YXRpb25cIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImdvdmVybm9yXCIsIGdldEdvdmVybm9yViksXG4gICAgICAgIG5ldyBBcmcoXCJuZXdJbXBsZW1lbnRhdGlvblwiLCBnZXRHb3Zlcm5vclYpLFxuICAgICAgXSxcbiAgICAgICh3b3JsZCwgZnJvbSwgeyBnb3Zlcm5vciwgbmV3SW1wbGVtZW50YXRpb24gfSkgPT5cbiAgICAgICAgc2V0SW1wbGVtZW50YXRpb24od29ybGQsIGZyb20sIGdvdmVybm9yLCBuZXdJbXBsZW1lbnRhdGlvbiksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG4gICAgbmV3IENvbW1hbmQ8eyBnb3Zlcm5vcjogR292ZXJub3JCcmF2bzsgbmV3UGVuZGluZ0FkbWluOiBBZGRyZXNzViB9PihcbiAgICAgIGBcbiAgICAgICAgIyMjIyBTZXRQZW5kaW5nQWRtaW5cblxuICAgICAgICAqIFwiR292ZXJub3JCcmF2byA8R292ZXJub3I+IFNldFBlbmRpbmdBZG1pbiA8QWRkcmVzc1Y+XCIgLSBTZXRzIHRoZSBhZGRyZXNzIGZvciB0aGUgR292ZXJub3JCcmF2byBwZW5kaW5nIGFkbWluXG4gICAgICAgICogRS5nLiBcIkdvdmVybm9yQnJhdm8gR292ZXJub3JCcmF2b1NjZW5hcmlvIFNldFBlbmRpbmdBZG1pbiBuZXdBZG1pblwiXG4gICAgYCxcbiAgICAgIFwiU2V0UGVuZGluZ0FkbWluXCIsXG4gICAgICBbXG4gICAgICAgIG5ldyBBcmcoXCJnb3Zlcm5vclwiLCBnZXRHb3Zlcm5vclYpLFxuICAgICAgICBuZXcgQXJnKFwibmV3UGVuZGluZ0FkbWluXCIsIGdldEFkZHJlc3NWKSxcbiAgICAgIF0sXG4gICAgICAod29ybGQsIGZyb20sIHsgZ292ZXJub3IsIG5ld1BlbmRpbmdBZG1pbiB9KSA9PlxuICAgICAgICBzZXRQZW5kaW5nQWRtaW4od29ybGQsIGZyb20sIGdvdmVybm9yLCBuZXdQZW5kaW5nQWRtaW4udmFsKSxcbiAgICAgIHsgbmFtZVBvczogMSB9XG4gICAgKSxcbiAgICBuZXcgQ29tbWFuZDx7IGdvdmVybm9yOiBHb3Zlcm5vckJyYXZvIH0+KFxuICAgICAgYFxuICAgICAgICAjIyMjIEFjY2VwdEFkbWluXG5cbiAgICAgICAgKiBcIkdvdmVybm9yQnJhdm8gPEdvdmVybm9yPiBBY2NlcHRBZG1pblwiIC0gUGVuZGluZyBhZG1pbiBhY2NlcHRzIHRoZSBhZG1pbiByb2xlXG4gICAgICAgICogRS5nLiBcIkdvdmVybm9yQnJhdm8gR292ZXJub3JCcmF2b1NjZW5hcmlvIEFjY2VwdEFkbWluXCJcbiAgICBgLFxuICAgICAgXCJBY2NlcHRBZG1pblwiLFxuICAgICAgW25ldyBBcmcoXCJnb3Zlcm5vclwiLCBnZXRHb3Zlcm5vclYpXSxcbiAgICAgICh3b3JsZCwgZnJvbSwgeyBnb3Zlcm5vciB9KSA9PiBhY2NlcHRBZG1pbih3b3JsZCwgZnJvbSwgZ292ZXJub3IpLFxuICAgICAgeyBuYW1lUG9zOiAxIH1cbiAgICApLFxuXG4gICAgbmV3IENvbW1hbmQ8e1xuICAgICAgZ292ZXJub3JEZWxlZ2F0b3I6IEdvdmVybm9yQnJhdm87XG4gICAgICBnb3Zlcm5vckRlbGVnYXRlOiBHb3Zlcm5vckJyYXZvO1xuICAgIH0+KFxuICAgICAgYCMjIyMgTWVyZ2VBQklcblxuICAgICAgICAqIFwiQ29tcHRyb2xsZXJJbXBsIDxJbXBsPiBNZXJnZUFCSVwiIC0gTWVyZ2VzIHRoZSBBQkksIGFzIGlmIGl0IHdhcyBhIGJlY29tZS5cbiAgICAgICAgKiBFLmcuIFwiQ29tcHRyb2xsZXJJbXBsIE15SW1wbCBNZXJnZUFCSVxuICAgICAgYCxcbiAgICAgIFwiTWVyZ2VBQklcIixcbiAgICAgIFtcbiAgICAgICAgbmV3IEFyZyhcImdvdmVybm9yRGVsZWdhdG9yXCIsIGdldEdvdmVybm9yViksXG4gICAgICAgIG5ldyBBcmcoXCJnb3Zlcm5vckRlbGVnYXRlXCIsIGdldEdvdmVybm9yViksXG4gICAgICBdLFxuICAgICAgKHdvcmxkLCBmcm9tLCB7IGdvdmVybm9yRGVsZWdhdG9yLCBnb3Zlcm5vckRlbGVnYXRlIH0pID0+XG4gICAgICAgIG1lcmdlQUJJKHdvcmxkLCBmcm9tLCBnb3Zlcm5vckRlbGVnYXRvciwgZ292ZXJub3JEZWxlZ2F0ZSksXG4gICAgICB7IG5hbWVQb3M6IDEgfVxuICAgICksXG4gIF07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzR292ZXJub3JCcmF2b0V2ZW50KFxuICB3b3JsZDogV29ybGQsXG4gIGV2ZW50OiBFdmVudCxcbiAgZnJvbTogc3RyaW5nIHwgbnVsbFxuKTogUHJvbWlzZTxXb3JsZD4ge1xuICByZXR1cm4gYXdhaXQgcHJvY2Vzc0NvbW1hbmRFdmVudDxhbnk+KFxuICAgIFwiR292ZXJub3JcIixcbiAgICBnb3Zlcm5vckJyYXZvQ29tbWFuZHMoKSxcbiAgICB3b3JsZCxcbiAgICBldmVudCxcbiAgICBmcm9tXG4gICk7XG59XG4iXX0=